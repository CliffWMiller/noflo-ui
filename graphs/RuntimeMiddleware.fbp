INPORT=Dispatch.IN:IN
OUTPORT=Passed.OUT:PASS
OUTPORT=NewActions.OUT:NEW

'runtime:open,context:edges,project:fromruntime,storage:ready' -> ROUTES Dispatch(ui/DispatchAction)

# New actions generated by this middleware
'storage:save:project' -> ACTION ProjectSaveAction(ui/SetAction) OUT -> IN NewActions(core/Merge)
'storage:save:graph' -> ACTION GraphSaveAction(ui/SetAction) OUT -> IN NewActions
'storage:save:component' -> ACTION ComponentSaveAction(ui/SetAction) OUT -> IN NewActions
'flowhub:runtimes:register' -> ACTION RuntimeRegisterAction(ui/SetAction) OUT -> IN NewActions
'storage:save:runtime' -> ACTION RuntimeSaveAction(ui/SetAction) OUT -> IN NewActions
'runtime:error' -> ACTION RuntimeErrorAction(ui/SetAction) OUT -> IN NewActions
'runtime:open' -> ACTION RuntimeOpenAction(ui/SetAction) OUT -> IN Passed

# Select a runtime to connect to
'runtimes' -> KEYS GetRuntimesState(ui/GetActionValues)
Dispatch HANDLE[0] -> IN GetRuntimesState
GetRuntimesState VALUES[0] -> RUNTIMES PopulateRuntimeData(ui/PopulateRuntimeData)
GetRuntimesState OUT -> IN PopulateRuntimeData
PopulateRuntimeData OUT -> IN RuntimeOpenAction

# Send selected edges to runtime
'runtime,graphs[0]' -> KEYS GetEdgeState(ui/GetActionValues)
Dispatch HANDLE[1] -> IN GetEdgeState
GetEdgeState VALUES[0] -> RUNTIME SendEdges(runtime/SendEdges)
GetEdgeState VALUES[1] -> GRAPH SendEdges
GetEdgeState OUT -> EDGES SendEdges

SendEdges OUT -> IN Passed(core/Merge)
Dispatch PASS -> IN Passed

# Create a project based on data on runtime side
Dispatch HANDLE[2] -> IN RuntimeToProject(ui/RuntimeToProject)
RuntimeToProject PROJECT -> IN ProjectSaveAction
RuntimeToProject GRAPH -> IN GraphSaveAction
RuntimeToProject COMPONENT -> IN ComponentSaveAction
RuntimeToProject RUNTIME -> IN RuntimeRegisterAction
RuntimeToProject ERROR -> IN RuntimeErrorAction

# Populate local runtimes
'runtimes' -> KEYS GetStoredRuntimes(ui/GetActionValues)
Dispatch HANDLE[3] -> IN GetStoredRuntimes
GetStoredRuntimes VALUES[0] -> IN EnsureLocalRuntimes(ui/EnsureLocalRuntimes)
EnsureLocalRuntimes OUT -> IN RuntimeSaveAction
